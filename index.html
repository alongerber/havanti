<!DOCTYPE html>

<html lang="he" dir="rtl">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>×§×¤×˜×Ÿ ×§×œ×™×§ - ×”×—×•×§×¨ ğŸ§­</title>

    

    <!-- Fonts & Icons -->

    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&family=Rubik:wght@400;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    

    <!-- KaTeX -->

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">

    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>

    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>



    <style>

        :root {

            --primary: #0F766E;    /* Deep Teal */

            --accent: #F59E0B;     /* Gold */

            --bg-dark: #064E3B;    /* Jungle Green */

            --text-light: #ECFDF5; 

            --card-bg: rgba(20, 50, 40, 0.75); /* Dark Glass */

            --border: rgba(255, 255, 255, 0.15);

        }



        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }



        body {

            font-family: 'Varela Round', 'Rubik', sans-serif;

            background-color: var(--bg-dark);

            color: var(--text-light);

            min-height: 100vh;

            display: flex;

            align-items: center;

            justify-content: center;

            overflow-x: hidden;

            /* Topographic Map Pattern */

            background-image: 

                radial-gradient(#ffffff 1px, transparent 1px),

                radial-gradient(#ffffff 1px, transparent 1px);

            background-size: 50px 50px;

            background-position: 0 0, 25px 25px;

            background-color: #042f2e;

            animation: mapMove 60s linear infinite;

        }



        @keyframes mapMove { from { background-position: 0 0, 25px 25px; } to { background-position: 100px 100px, 125px 125px; } }



        .app-container {

            width: 95%;

            max-width: 500px;

            min-height: 650px;

            background: var(--card-bg);

            backdrop-filter: blur(15px);

            -webkit-backdrop-filter: blur(15px);

            border: 1px solid var(--border);

            border-radius: 32px;

            padding: 30px;

            box-shadow: 0 20px 50px rgba(0,0,0,0.5);

            position: relative;

            margin-top: 50px;

        }



        /* Avatar */

        .avatar-container {

            position: absolute;

            top: -60px;

            left: 50%;

            transform: translateX(-50%);

            width: 120px;

            height: 120px;

            border-radius: 50%;

            border: 4px solid var(--accent);

            background: #fff;

            overflow: hidden;

            box-shadow: 0 10px 20px rgba(0,0,0,0.3);

            z-index: 10;

            animation: float 4s ease-in-out infinite;

        }

        .avatar-img { width: 100%; height: 100%; object-fit: cover; }



        @keyframes float { 0%, 100% { transform: translateX(-50%) translateY(0); } 50% { transform: translateX(-50%) translateY(-10px); } }



        h1 { 

            text-align: center; margin-top: 50px; margin-bottom: 10px; 

            font-size: 2rem; color: var(--accent); text-shadow: 0 2px 4px rgba(0,0,0,0.3); 

        }

        .subtitle { text-align: center; color: #A7F3D0; margin-bottom: 30px; font-size: 1rem; opacity: 0.8; }



        .hidden { display: none !important; }

        .fade-in { animation: fadeIn 0.5s ease forwards; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }



        /* UI Elements */

        input, textarea {

            width: 100%;

            background: rgba(0, 0, 0, 0.3);

            border: 2px solid var(--border);

            color: white;

            padding: 16px;

            border-radius: 16px;

            font-size: 1.1rem;

            font-family: inherit;

            margin-bottom: 15px;

            transition: 0.3s;

        }

        input:focus, textarea:focus { outline: none; border-color: var(--accent); background: rgba(0,0,0,0.5); }



        .btn {

            width: 100%; padding: 18px; border: none; border-radius: 16px;

            font-size: 1.1rem; font-weight: 700; cursor: pointer;

            transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px;

            color: #064E3B; margin-top: 10px;

            box-shadow: 0 4px 0 rgba(0,0,0,0.2);

        }

        .btn:active { transform: translateY(4px); box-shadow: none; }

        

        .btn-primary { background: linear-gradient(to bottom, #FCD34D, #F59E0B); }

        .btn-success { background: linear-gradient(to bottom, #6EE7B7, #10B981); }

        .btn-secondary { background: rgba(255,255,255,0.1); color: white; border: 1px solid var(--border); }



        .grid-select { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }

        .select-card {

            background: rgba(255,255,255,0.05); border: 2px solid transparent;

            padding: 20px; border-radius: 16px; text-align: center; cursor: pointer; transition: 0.3s;

        }

        .select-card:hover { background: rgba(255,255,255,0.1); }

        .select-card.selected { border-color: var(--accent); background: rgba(245, 158, 11, 0.2); }

        .select-card i { font-size: 1.8rem; margin-bottom: 10px; display: block; color: var(--accent); }



        .content-box {

            background: rgba(0,0,0,0.25); border-radius: 20px; padding: 25px;

            margin-bottom: 20px; line-height: 1.7; font-size: 1.2rem;

            border: 1px solid var(--border); position: relative;

        }

        .stage-badge {

            position: absolute; top: -12px; right: 20px;

            background: var(--accent); color: #064E3B;

            padding: 4px 12px; border-radius: 12px; font-size: 0.85rem; font-weight: bold;

            box-shadow: 0 2px 5px rgba(0,0,0,0.2);

        }



        .visual-area {

            text-align: center; 
            margin: 20px 0;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 16px;
            animation: fadeIn 0.5s ease;

        }

        .visual-area svg {

            max-width: 100%;
            height: auto;
            max-height: 300px;
            width: auto;
            display: block;
            margin: 0 auto;
            animation: bounce 2s infinite;

        }

        .visual-area:has(svg) {

            background: rgba(15, 118, 110, 0.1);
            border: 2px solid rgba(20, 184, 166, 0.2);

        }

        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }



        .compass-loader {

            font-size: 4rem; color: var(--accent);

            animation: spinCompass 2s infinite ease-in-out;

            margin-bottom: 20px;

        }

        @keyframes spinCompass { 0% { transform: rotate(0deg); } 80% { transform: rotate(360deg); } 100% { transform: rotate(360deg); } }



        #feedbackArea { margin-top: 15px; border-radius: 12px; text-align: center; font-weight: bold; padding: 0; overflow: hidden;}

        .fb-msg { padding: 15px; animation: fadeIn 0.3s; }

        .fb-success { background: rgba(16, 185, 129, 0.2); color: #6EE7B7; border: 1px solid #10B981; }

        .fb-error { background: rgba(239, 68, 68, 0.2); color: #FCA5A5; border: 1px solid #EF4444; }

    </style>

</head>

<body>



    <div class="app-container">

        <div class="avatar-container">

            <img src="https://i.imgur.com/58QMFtb.png" alt="Captain Click" class="avatar-img">

        </div>



        <!-- Step 1: Welcome -->

        <div id="step-welcome" class="fade-in">

            <h1>×‘×¨×•×›×™× ×”×‘××™×!</h1>

            <p class="subtitle">××•×›× ×™× ×œ×¦××ª ×œ×”×¨×¤×ª×§×” ×•×œ×’×œ×•×ª ××ª ×¡×•×“×•×ª ×”××ª××˜×™×§×”?</p>

            <input type="text" id="inpName" placeholder="××™×š ×§×•×¨××™× ×œ×š?">

            <div class="grid-select">

                <div class="select-card" onclick="setGender('boy')" id="btnBoy"><i class="fa-solid fa-hat-cowboy"></i> ×—×•×§×¨</div>

                <div class="select-card" onclick="setGender('girl')" id="btnGirl"><i class="fa-solid fa-hat-cowboy-side"></i> ×—×•×§×¨×ª</div>

            </div>

            <textarea id="inpInterests" rows="2" placeholder="××” ××¢× ×™×™×Ÿ ××•×ª×š? (×œ××©×œ: ×“×™× ×•×–××•×¨×™×, ×¨×™×§×•×“, ×›×“×•×¨×’×œ...)"></textarea>

            <button class="btn btn-primary" onclick="goToGrade()">×”×ª×—×œ ××¡×¢ <i class="fa-solid fa-map"></i></button>

        </div>



        <!-- Step 2: Grade -->

        <div id="step-grade" class="hidden">

            <h1>×‘×—×¨ ×“×¨×’×”</h1>

            <div class="grid-select" style="grid-template-columns: 1fr;">

                <div class="select-card" onclick="setGrade('1-2')">×›×™×ª×•×ª ××³ - ×‘×³ (××ª×—×™×œ×™×)</div>

                <div class="select-card" onclick="setGrade('3-4')">×›×™×ª×•×ª ×’×³ - ×“×³ (××ª×§×“××™×)</div>

                <div class="select-card" onclick="setGrade('5-6')">×›×™×ª×•×ª ×”×³ - ×•×³ (××•××—×™×)</div>

            </div>

        </div>



        <!-- Step 3: Topic -->

        <div id="step-topic" class="hidden">

            <h1>×‘×—×¨ ×™×¢×“ ×‘××¤×”</h1>

            <div id="topicsGrid" class="grid-select"></div>

        </div>



        <!-- Step 4: Loading -->

        <div id="step-loading" class="hidden" style="text-align: center; padding-top: 40px;">

            <div class="compass-loader"><i class="fa-regular fa-compass"></i></div>

            <h3 id="loadingText">×§×•×¨× ××ª ×”××¤×”...</h3>

        </div>



        <!-- Step 5: Learn -->

        <div id="step-learn" class="hidden">

            <div style="display:flex; justify-content:space-between; margin-bottom:15px; opacity:0.7; font-size:0.9rem;">

                <span id="stageIndicator">×ª×—× ×” 1 ××ª×•×š 5</span>

                <span id="userTitle">×”×—×•×§×¨</span>

            </div>

            <div id="learnContent" class="content-box"></div>

            

            <div id="questionArea" class="hidden">

                <input type="text" id="inpAnswer" placeholder="×”×›× ×¡ ××ª ×”×ª×©×•×‘×”..." autocomplete="off">

                <div style="display:grid; grid-template-columns: 2fr 1fr; gap: 10px;">

                    <button class="btn btn-success" onclick="checkAnswer()">×‘×“×•×§ <i class="fa-solid fa-check"></i></button>

                    <button class="btn btn-secondary" onclick="showHint()">×¨××– <i class="fa-solid fa-magnifying-glass"></i></button>

                </div>

            </div>



            <div id="explanationArea">

                <button class="btn btn-primary" onclick="nextStage()">×”××©×š ×‘××¡×¢ <i class="fa-solid fa-arrow-left"></i></button>

            </div>

            <div id="feedbackArea"></div>

        </div>



        <!-- Step 6: Finish -->

        <div id="step-finish" class="hidden" style="text-align: center; padding-top: 20px;">

            <i class="fa-solid fa-gem" style="font-size: 5rem; color: var(--accent); margin-bottom: 20px; animation: bounce 2s infinite;"></i>

            <h1>××¦××ª ××ª ×”××•×¦×¨!</h1>

            <p class="subtitle" id="finishText">×›×œ ×”×›×‘×•×“!</p>

            <button class="btn btn-primary" onclick="location.reload()">×”×¨×¤×ª×§×” ×—×“×©×”</button>

        </div>

    </div>



    <script>

        let user = { name: '', gender: 'boy', grade: '', interests: '', topic: '', stage: 1 };

        let currentData = null;



        function showStep(id) {

            document.querySelectorAll('.app-container > div:not(.avatar-container)').forEach(d => d.classList.add('hidden'));

            document.getElementById(id).classList.remove('hidden');

            document.getElementById(id).classList.add('fade-in');

        }



        function setGender(g) {

            user.gender = g;

            document.querySelectorAll('.select-card').forEach(c => c.classList.remove('selected'));

            document.getElementById(g === 'boy' ? 'btnBoy' : 'btnGirl').classList.add('selected');

        }



        function goToGrade() {

            user.name = document.getElementById('inpName').value || '×—×•×§×¨';

            user.interests = document.getElementById('inpInterests').value || '×”×¨×¤×ª×§××•×ª';

            document.getElementById('userTitle').innerText = user.gender === 'girl' ? '×”×—×•×§×¨×ª ' + user.name : '×”×—×•×§×¨ ' + user.name;

            showStep('step-grade');

        }



        function setGrade(g) {

            user.grade = g;

            const topics = {

                '1-2': ['×—×™×‘×•×¨', '×—×™×¡×•×¨', '×¦×•×¨×•×ª'],

                '3-4': ['×›×¤×œ', '×—×™×œ×•×§', '×©×‘×¨×™×'],

                '5-6': ['××—×•×–×™×', '×©×‘×¨×™× ×¢×©×¨×•× ×™×™×', '×—×–×§×•×ª']

            };

            const grid = document.getElementById('topicsGrid');

            grid.innerHTML = '';

            topics[g].forEach(t => {

                grid.innerHTML += `<div class="select-card" onclick="startTopic('${t}')"><i class="fa-solid fa-map-location-dot"></i> ${t}</div>`;

            });

            showStep('step-topic');

        }



        function startTopic(t) {

            user.topic = t;

            user.stage = 1;

            fetchContent();

        }



        async function fetchContent() {

            showStep('step-loading');

            document.getElementById('loadingText').innerText = `×—×•×§×¨ ××ª ×ª×—× ×” ${user.stage}...`;



            try {

                const res = await fetch('/api/explain', {

                    method: 'POST',

                    headers: { 'Content-Type': 'application/json' },

                    body: JSON.stringify(user)

                });

                const data = await res.json();

                currentData = data;

                renderLearning(data);

            } catch (e) {

                console.error(e);

                renderLearning({ content: "×”××¦×¤×Ÿ ×”×©×ª×’×¢! ×‘×•× × × ×¡×” ×©×•×‘.", isQuestion: false, visual: "ğŸ§­", nextButtonText: "× ×¡×” ×©×•×‘" });

            }

        }



        function renderLearning(data) {

            showStep('step-learn');

            document.getElementById('stageIndicator').innerText = `×ª×—× ×” ${user.stage} ××ª×•×š 5`;

            

            let badgeText = "×”×¡×‘×¨";

            if(user.stage === 1) badgeText = "×”×¡×™×¤×•×¨";

            if(user.stage === 3) badgeText = "×”×˜×¨×™×§ ×”×¡×•×“×™";

            if(user.stage >= 4) badgeText = "××ª×’×¨";



            let html = `<div class="stage-badge">${badgeText}</div>`;

            html += `<p>${data.content}</p>`;

            if (data.visual) { html += `<div class="visual-area">${data.visual}</div>`; }

            document.getElementById('learnContent').innerHTML = html;



            if (window.renderMathInElement) {

                window.renderMathInElement(document.getElementById('learnContent'), {

                    delimiters: [{left:"$$", right:"$$", display:true}, {left:"$", right:"$", display:false}]

                });

            }



            document.getElementById('inpAnswer').value = '';

            document.getElementById('feedbackArea').innerHTML = '';



            if (data.isQuestion) {

                document.getElementById('questionArea').classList.remove('hidden');

                document.getElementById('explanationArea').classList.add('hidden');

            } else {

                document.getElementById('questionArea').classList.add('hidden');

                document.getElementById('explanationArea').classList.remove('hidden');

                document.querySelector('#explanationArea button').innerHTML = (data.nextButtonText || '×”××©×š ×‘××¡×¢') + ' <i class="fa-solid fa-arrow-left"></i>';

            }

        }



        function checkAnswer() {

            const val = document.getElementById('inpAnswer').value.trim();

            const correct = currentData.correctAnswer;

            const fb = document.getElementById('feedbackArea');



            if (val == correct || val.toLowerCase() == correct.toString().toLowerCase()) {

                fb.innerHTML = `<div class="fb-msg fb-success">ğŸ‰ ××¦×•×™×Ÿ! ×”×§×•×“ ×¤×•×¦×—!</div>`;

                setTimeout(nextStage, 1500);

            } else {

                fb.innerHTML = `<div class="fb-msg fb-error">âŒ ×œ× ×‘×“×™×•×§... × ×¡×” ×©×•×‘!</div>`;

            }

        }



        function showHint() {

            const hint = currentData.hint || '× ×¡×” ×œ×”×™×–×›×¨ ×‘×˜×¨×™×§ ×”×¡×•×“×™...';

            document.getElementById('feedbackArea').innerHTML = `<div class="fb-msg" style="background:rgba(245, 158, 11, 0.2); color:#FCD34D;">ğŸ’¡ ${hint}</div>`;

        }



        function nextStage() {

            if (user.stage < 5) { user.stage++; fetchContent(); } 

            else { showStep('step-finish'); createConfetti(); }

        }



        function createConfetti() {

             var duration = 3 * 1000;

             var animationEnd = Date.now() + duration;

             var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

             var interval = setInterval(function() {

               var timeLeft = animationEnd - Date.now();

               if (timeLeft <= 0) { return clearInterval(interval); }

               var particleCount = 50 * (timeLeft / duration);

               confetti(Object.assign({}, defaults, { particleCount, origin: { x: Math.random(), y: Math.random() - 0.2 } }));

             }, 250);

        }

        

        const script = document.createElement('script');

        script.src = "https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js";

        document.head.appendChild(script);

    </script>

</body>

</html>
